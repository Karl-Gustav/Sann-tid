<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular-resource.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/sugar/1.3.9/sugar.min.js"></script>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
</head>
<body ng-app="testApp">
<h1>Questions app</h1>
<ul>
	<li><a href="#/addQuestion">Add question</a></li>
	<li><a href="#/showQuestion">Show a question</a></li>
	<li><a href="#/showAllQuestions">Show all questions</a><br /></li>
</ul>
<ng-view></ng-view>
<footer>Made by me</footer>
<script>
	var app = angular.module('testApp', ['ngResource'])

	app.config(function($routeProvider){
		$routeProvider
				.when('/',{
					controller: "showAllQuestionsController",
					templateUrl: "partials/showAllQuestions.html"
				})
				.when('/showQuestion',{
					controller: "showQuestionController",
					templateUrl: "partials/showQuestion.html"
				})
				.when('/addQuestion',{
					controller: "addQuestionsController",
					templateUrl: "partials/addQuestion.html"
				})
				.otherwise({redirectTo: "/"})
	})

	app.factory('questionService', function($resource){
		return $resource('/rest/questions/:id', {id:'@id'}, {
			update: {
				method: 'PUT'
			}
		})
	})

	app.controller("showAllQuestionsController", function($scope, questionService){

		questionService.query(function(data){
			console.log("data", data)
			$scope.questions = data
		})
	})

	app.controller("showQuestionController", function($scope, questionService){

		function getRandomQuestion(callback){
			questionService.query(function(data){
				callback(data[0])
			})
		}
		getRandomQuestion(function(data){
			$scope.question = data
		})

	})


	app.controller("addQuestionsController", function($scope, questionService){
		$scope.addedQuestions = []
		$scope.saveQuestion = function(){

			console.log("inside saveQuestion")
			var question = new questionService({
				text: $scope.questionText,
				answer: $scope.answer,
				waitUntil: Date.create().toISOString()
			})

			console.log("question", question)
			question.$save()

			$scope.addedQuestions.push(question)
		}
	})



</script>
</body>
</html>
